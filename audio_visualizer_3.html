<!DOCTYPE html>
<html>
<head>
	<title>Audio Visualizer 3.0</title>
</head>
<body>
<audio id="audio">
 <source id="src" type="audio/mp3"></source>
 HTML5 Audio element is not supported on your browser.
</audio>
<p onclick="var eve=new MouseEvent('click');fEle.dispatchEvent(eve);">click me</p>

<input type="file" id="files" accept="audio/*;capture=microphone" multiple style="display:none;">
<p id="op"></p>
<canvas id="can" width = 1000 height = 200></canvas>
<script>
var aSrc=document.getElementById("src");
var aEle=document.getElementById("audio");
var fEle=document.getElementById("files");
var op=document.getElementById("op");
var audioCtx= new (window.AudioContext || window.webkitAudioContext)();
var source=audioCtx.createMediaElementSource(aEle);
var mSource;
var ct = document.getElementById("can").getContext("2d");
var analyser=audioCtx.createAnalyser();
var gainNode = audioCtx.createGain();
source.connect(analyser);
analyser.connect(gainNode);
gainNode.connect(audioCtx.destination);
gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
fEle.addEventListener("change",function(){aSrc.src=URL.createObjectURL(fEle.files[0]);aEle.load();aEle.play();})
var arr=new Uint8Array(analyser.frequencyBinCount);
dataArray = new Float32Array(analyser.frequencyBinCount);
function update(){
	requestAnimationFrame(update);
	analyser.getByteFrequencyData(arr);
									//op.innerHTML=Math.max.apply(null,arr);

  analyser.getFloatTimeDomainData(dataArray);
	
	ct.clearRect(0,0,1000,200);
	ct.strokeStyle="black";
	ct.fillStyle="Green";
	ct.beginPath();
	ct.moveTo(0,-arr[0]+200);
	for(var i = 1;i<arr.length;i++){
		ct.lineTo(1000/arr.length*i,-arr[i]+200);
	}
	ct.lineTo(1000,200);
	ct.lineTo(0,200);
	ct.fill();
	ct.stroke();

	ct.beginPath();
ct.moveTo(0,height/2);
for(var a=0;a<dataArray.length;a++){
ct.lineTo(a*(200/dataArray.length),(dataArray[a]*500)+500)
}
ct.strokeStyle="rgba(255,0,0,128)"
					
ct.stroke();

	
}
update();
var errorCallback = function(e) {
    console.log(e);
  };
if (navigator.mediaDevices.getUserMedia) {
  navigator.mediaDevices.getUserMedia({audio: true, video: false}).then( function(stream) {
    mSource = audioCtx.createMediaStreamSource(stream);
		mSource.connect(analyser);
	console.log(stream)
  }).catch(errorCallback);
} else {
  //video.src = 'somevideo.webm'; // fallback.
	console.log("Shrug");
}
  
</script>

</body>
</html>
